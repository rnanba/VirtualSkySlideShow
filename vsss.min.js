function VirtualSkySlideShow(opt){var ss=this;for(var key in popt={projection:"stereo",constellations:!0,showplanets:!0,showplanetlabels:!1,showdate:!0,scalestars:1.5,mouse:!0,keyboad:!0,callback:{click:function(e){if(ss.pause=!ss.pause,!ss.pause)if(ss.slides&&ss.slides.length!=ss.slideIndex)ss.show&&ss.start();else{var src=ss.url?ss.url:ss.data;ss.slideShow(src)}}}},this.startId=0,this.url=opt.url,this.data=opt.data,delete opt.url,delete opt.data,opt)popt[key]=opt[key];S("head").append('<style type="text/css">.'+popt.id+"_btn_help { display: none !important; } #"+popt.id+".fullscreen {  width: 100vw !important;  height: 100vh !important;}</style>");var elm=document.getElementById(popt.id),maxWidth=document.documentElement.clientWidth-elm.getBoundingClientRect().left,width=elm.clientWidth,height=elm.clientHeight;if(maxWidth<width){var scale=maxWidth/width;width=maxWidth,height*=scale,elm.style.backgroundSize=width+"px"}return elm.style.width=width+"px",elm.style.height=height+"px",this.planetarium=S.virtualsky(popt),this.planetarium.showhelp=!1,this.planetarium.credit=!1,this.planetarium.draw(),this.pause=!0,this.show=!1,this.clockMove={},this.azMove={},this.RA_REGEXP=/^\s*(\d+)h\s*(\d+)m\s*(\d+(\.\d+)?)s\s*$/,this.DEC_REGEXP=/^\s*([+-]?\d+)[°º]\s*(\d+)['′]\s*(\d+(\.\d+)?)["″]?\s*$/,this.PLANET_INDEX={Mercury:0,Venus:1,Mars:2,Jupiter:3,Saturn:4,Uranus:5,Neptune:6},this.config={},this.slides=[],this.slideIndex=0,this}VirtualSkySlideShow.prototype.moveToClock=function(date,duration,onEnd){this.planetarium.spin=!1,this.clockMove={duration:duration,start:new Date,from:this.planetarium.clock,to:date,onEnd:onEnd},this.moveClockStep()},VirtualSkySlideShow.prototype.moveClockStep=function(){var t=(new Date-this.clockMove.start)/this.clockMove.duration,time=this.clockMove.from.getTime()+(this.clockMove.to.getTime()-this.clockMove.from.getTime())*t;if(this.planetarium.updateClock(new Date(time)),t<1){this.planetarium.drawImmediate();var _obj=this;requestAnimFrame(function(){_obj.moveClockStep()})}else this.planetarium.updateClock(this.clockMove.to),this.planetarium.trigger("loadedPlanets"),this.planetarium.drawImmediate(),this.clockMove.onEnd&&this.clockMove.onEnd()},VirtualSkySlideShow.prototype.moveToAz=function(az,duration,onEnd){var to=az%360-180,d=to-this.planetarium.az_off;d>180?to-=360:d<-180&&(to+=360),this.azMove={duration:duration,start:new Date,from:this.planetarium.az_off,to:to,onEnd:onEnd},this.moveAzStep()},VirtualSkySlideShow.prototype.moveAzStep=function(){var t=(new Date-this.azMove.start)/this.azMove.duration;if(this.planetarium.az_off=this.azMove.from+(this.azMove.to-this.azMove.from)*t,t<1){this.planetarium.drawImmediate();var _obj=this;requestAnimFrame(function(){_obj.moveAzStep()})}else this.planetarium.az_off=this.azMove.to,this.planetarium.drawImmediate(),this.azMove.onEnd&&this.azMove.onEnd()},VirtualSkySlideShow.prototype.moveToRADec=function(ra,dec,label,duration,onEnd){if("string"==typeof ra){var f=this.RA_REGEXP.exec(ra);ra=15*parseInt(f[1],10)+15*parseInt(f[2],10)/60+15*parseFloat(f[3])/60/60}if("string"==typeof dec){f=this.DEC_REGEXP.exec(dec);dec=parseInt(f[1],10)+1*parseInt(f[2],10)/60+1*parseFloat(f[3])/60/60}var horizon=this.planetarium.coord2horizon(ra*this.planetarium.d2r,dec*this.planetarium.d2r);this.planetarium.pointers=[],this.planetarium.addPointer({ra:ra,dec:dec,label:label}),this.moveToAz(horizon[1]*this.planetarium.r2d,duration,onEnd)},VirtualSkySlideShow.prototype.moveToPlanet=function(name,label,duration,onEnd){var ra,dec;if("Sun"===name)ra=this.planetarium.lookup.sun[0].ra*this.planetarium.r2d,dec=this.planetarium.lookup.sun[0].dec*this.planetarium.r2d;else if("Moon"===name)ra=this.planetarium.lookup.moon[0].ra*this.planetarium.r2d,dec=this.planetarium.lookup.moon[0].dec*this.planetarium.r2d;else{var i=this.PLANET_INDEX[name];ra=this.planetarium.lookup.planet[i].ra*this.planetarium.r2d,dec=this.planetarium.lookup.planet[i].dec*this.planetarium.r2d}this.moveToRADec(ra,dec,label,duration,onEnd)},VirtualSkySlideShow.prototype.loadImage=function(url){this.planetarium.container.css({"background-image":'url("'+url+'")'})},VirtualSkySlideShow.prototype.showImage=function(url){var css={"background-color":"black","background-image":'url("'+url+'")',"background-position":"center","background-repeat":"no-repeat","background-size":"contain"};this.planetarium.container.css(css),this.planetarium.canvas.css({transition:"opacity 0.5s ease-in-out"}),this.planetarium.canvas.css({opacity:"0"}),this.show=!0},VirtualSkySlideShow.prototype.hideImage=function(){this.planetarium.canvas.css({opacity:"1"}),this.show=!1},VirtualSkySlideShow.prototype.nextSlide=function(auto,startId){var ss=this,slide=ss.slides[ss.slideIndex++],next=ss.slides.length>ss.slideIndex?function(){ss.pause||ss.startId!=startId||ss.nextSlide(auto,startId)}:function(){ss.pause=!0},show=function(){setTimeout(function(){ss.showImage(slide.image),!ss.pause&&auto&&setTimeout(next,ss.config.image_duration)},ss.config.stop_duration)},pan=function(){slide.planet?ss.moveToPlanet(slide.planet,slide.label,ss.config.pan_duration,show):ss.moveToRADec(slide.ra,slide.dec,slide.label,ss.config.pan_duration,show)},spin=function(){ss.loadImage(slide.image),ss.planetarium.pointers=[],ss.moveToClock(new Date(slide.date),ss.config.spin_duration,pan)},waitandgo=function(){document.removeEventListener("transitionend",waitandgo),setTimeout(spin,ss.config.stop_durationn)};ss.show?(document.addEventListener("transitionend",waitandgo),ss.hideImage()):waitandgo()},VirtualSkySlideShow.prototype.slideShow=function(src){"string"==typeof src?this.planetarium.loadJSON(src,function(data){ss.startSlideShow(data)}):this.startSlideShow(src)},VirtualSkySlideShow.prototype.startSlideShow=function(data){var ss=this;ss.config=data.config,ss.planetarium.setLatitude(ss.config.latitude),ss.planetarium.setLongitude(ss.config.longitude),ss.planetarium.updateClock(new Date(ss.config.date)),ss.planetarium.az_off=ss.config.az%360-180,ss.planetarium.drawImmediate(),ss.slides=data.slides,ss.slideIndex=0,setTimeout(function(){ss.start()},ss.config.stop_duration)},VirtualSkySlideShow.prototype.start=function(){var oldId=ss.startId;ss.startId++,ss.startId==oldId&&(ss.startId=0),ss.nextSlide(!0,ss.startId)};